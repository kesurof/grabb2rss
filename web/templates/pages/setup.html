{% extends "base.html" %}

{% block title %}Configuration Initiale - Grabb2RSS{% endblock %}
{% block page_id %}setup{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/app.css">
{% endblock %}

{% block legacy_css %}{% endblock %}

{% block shell %}
    {{ self.content() }}
{% endblock %}

{% block content %}
    <div class="container" data-first-run="{{ 'true' if first_run else 'false' }}" data-config-exists="{{ 'true' if config_exists else 'false' }}">
        <header>
            <h1>üöÄ Bienvenue sur grabb2RSS</h1>
            <p class="subtitle">Configuration initiale</p>
        </header>

        <div id="alert" class="alert"></div>
        <div id="loading" class="loading" data-role="loading">
            <div class="spinner"></div>
            <p style="margin-top: 15px; color: #888;">Validation et sauvegarde en cours...</p>
        </div>

        <form id="setupForm">
            <!-- Applications Grid Layout -->
            <div class="apps-grid">
                <!-- Prowlarr (Obligatoire) -->
                <div class="section">
                    <div class="section-title">üîç Prowlarr (Obligatoire)</div>
                    <div class="form-group">
                        <label>
                            URL de Prowlarr <span class="required">*</span>
                        </label>
                        <input type="url" id="prowlarr_url" name="prowlarr_url"
                               value="http://prowlarr:9696" placeholder="http://prowlarr:9696" required>
                        <div class="help-text">
                            URL compl√®te de votre instance Prowlarr (avec le port)
                        </div>
                    </div>
                    <div class="form-group">
                        <label>
                            Cl√© API Prowlarr <span class="required">*</span>
                        </label>
                        <input type="text" id="prowlarr_api_key" name="prowlarr_api_key"
                               placeholder="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" required>
                        <div class="help-text">
                            Prowlarr &gt; Param√®tres &gt; G√©n√©ral &gt; S√©curit√©
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Taille de l'historique</label>
                        <input type="number" id="prowlarr_history_page_size"
                               name="prowlarr_history_page_size" value="500" min="100" max="1000">
                        <div class="help-text">Nombre de grabs √† r√©cup√©rer par sync (d√©faut: 500)</div>
                    </div>
                </div>

                <!-- Radarr (Obligatoire) -->
                <div class="section">
                    <div class="section-title">üé¨ Radarr (Obligatoire)</div>
                    <div class="form-group">
                        <label>
                            URL de Radarr <span class="required">*</span>
                        </label>
                        <input type="url" id="radarr_url" name="radarr_url"
                               value="http://radarr:7878" placeholder="http://radarr:7878" required>
                        <div class="help-text">URL compl√®te de votre instance Radarr</div>
                    </div>
                    <div class="form-group">
                        <label>
                            Cl√© API Radarr <span class="required">*</span>
                        </label>
                        <input type="text" id="radarr_api_key" name="radarr_api_key"
                               placeholder="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" required>
                        <div class="help-text">Radarr &gt; Param√®tres &gt; G√©n√©ral &gt; S√©curit√©</div>
                    </div>
                </div>

                <!-- Sonarr (Obligatoire) -->
                <div class="section">
                    <div class="section-title">üì∫ Sonarr (Obligatoire)</div>
                    <div class="form-group">
                        <label>
                            URL de Sonarr <span class="required">*</span>
                        </label>
                        <input type="url" id="sonarr_url" name="sonarr_url"
                               value="http://sonarr:8989" placeholder="http://sonarr:8989" required>
                        <div class="help-text">URL compl√®te de votre instance Sonarr</div>
                    </div>
                    <div class="form-group">
                        <label>
                            Cl√© API Sonarr <span class="required">*</span>
                        </label>
                        <input type="text" id="sonarr_api_key" name="sonarr_api_key"
                               placeholder="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" required>
                        <div class="help-text">Sonarr &gt; Param√®tres &gt; G√©n√©ral &gt; S√©curit√©</div>
                    </div>
                </div>
            </div>

            <!-- Param√®tres avanc√©s -->
            <div class="section">
                <div class="section-title">‚öôÔ∏è Param√®tres</div>
                <div class="form-group">
                    <label>Intervalle de synchronisation (secondes)</label>
                    <input type="number" id="sync_interval" name="sync_interval" value="3600">
                    <div class="help-text">Fr√©quence de synchronisation avec Prowlarr (3600 = 1 heure)</div>
                </div>
                <div class="form-group">
                    <label>R√©tention des torrents (heures)</label>
                    <input type="number" id="retention_hours" name="retention_hours" value="168">
                    <div class="help-text">Dur√©e de conservation des torrents (168 = 7 jours)</div>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="auto_purge" name="auto_purge" checked>
                    <label for="auto_purge" class="form-label" style="margin: 0;">
                        Purge automatique des anciens torrents
                    </label>
                </div>
            </div>

            <!-- Section: Authentification -->
            <div class="section">
                <div class="section-title">üîê Authentification (Optionnel mais Recommand√©)</div>
                <div class="alert-info" style="background: #003366; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #1e90ff;">
                    <strong>üí° Protection de votre interface</strong><br>
                    <span style="font-size: 13px; color: #ddd;">
                        Activez l'authentification pour prot√©ger l'acc√®s √† votre interface web.
                        Les flux RSS locaux resteront accessibles sans authentification,
                        mais vous pourrez g√©n√©rer des API Keys pour l'acc√®s externe.
                    </span>
                </div>
                <div class="checkbox-group" style="margin-bottom: 20px;">
                    <input type="checkbox" id="auth_enabled" name="auth_enabled" data-action="toggle-auth">
                    <label for="auth_enabled" class="form-label" style="margin: 0; font-weight: 600; color: #1e90ff;">
                        ‚úÖ Activer l'authentification
                    </label>
                </div>
                <div id="auth_fields" style="display: none;">
                    <div class="form-group">
                        <label>Nom d'utilisateur <span class="required">*</span></label>
                        <input type="text" id="auth_username" name="auth_username"
                               placeholder="admin" autocomplete="username">
                        <div class="help-text">Choisissez un nom d'utilisateur pour vous connecter</div>
                    </div>
                    <div class="form-group">
                        <label>Mot de passe <span class="required">*</span></label>
                        <input type="password" id="auth_password" name="auth_password"
                               placeholder="Mot de passe s√©curis√©" autocomplete="new-password">
                        <div class="help-text">Minimum 8 caract√®res recommand√©s</div>
                    </div>
                </div>
            </div>

            <!-- Boutons -->
            <div class="button-group">
                <button type="button" class="btn btn-secondary" data-action="test-connection">
                    üîå Tester la connexion
                </button>
                <button type="submit" class="btn btn-primary" data-action="submit-setup">
                    ‚úÖ Enregistrer et d√©marrer
                </button>
            </div>
        </form>

        <div style="margin-top: 30px; text-align: center; color: #777; font-size: 12px;">
            Version {{ version }}
        </div>
    </div>

{% endblock %}

{% block scripts %}
<script src="/static/js/app.js"></script>
{% endblock %}
