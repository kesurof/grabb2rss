{% extends "base.html" %}

{% block title %}Configuration Initiale - Grabb2RSS{% endblock %}
{% block page_id %}setup{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/app.css">
{% endblock %}

{% block legacy_css %}{% endblock %}

{% block shell %}
    {{ self.content() }}
{% endblock %}

{% block content %}
    <div class="page-shell" data-first-run="{{ 'true' if first_run else 'false' }}" data-config-exists="{{ 'true' if config_exists else 'false' }}">
        <div class="page-header">
            <h1>Configuration initiale</h1>
            <p class="page-desc">Renseignez vos services externes et param√®tres de base pour d√©marrer.</p>
        </div>

        <div id="alert" class="alert"></div>
        <div id="loading" class="loading" data-role="loading">
            <div class="spinner"></div>
            <p class="section-note">Validation et sauvegarde en cours...</p>
        </div>

        <form id="setupForm">
            <div class="page-section">
                <div class="section-header">Services externes</div>
                <div class="section-note">Ajoutez les URL et cl√©s API de vos services. Les champs obligatoires sont marqu√©s.</div>

                <div class="section-grid">
                    <div class="service-card">
                        <div class="service-title"><span>üîç</span>Prowlarr</div>
                        <div class="form-field">
                            <label class="form-label">URL <span class="required">*</span></label>
                            <input class="form-input" type="url" id="prowlarr_url" name="prowlarr_url"
                                   value="http://prowlarr:9696" placeholder="http://prowlarr:9696" required>
                            <div class="form-help">URL compl√®te de l‚Äôinstance (avec port).</div>
                        </div>
                        <div class="form-field">
                            <label class="form-label">Cl√© API <span class="required">*</span></label>
                            <input class="form-input" type="text" id="prowlarr_api_key" name="prowlarr_api_key"
                                   placeholder="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" required>
                            <div class="form-help">Prowlarr ‚Üí Param√®tres ‚Üí S√©curit√©.</div>
                        </div>
                        <div class="form-field">
                            <label class="form-label">Historique</label>
                            <input class="form-input" type="number" id="prowlarr_history_page_size"
                                   name="prowlarr_history_page_size" value="500" min="100" max="1000">
                            <div class="form-help">Grabs r√©cup√©r√©s par sync (d√©faut 500).</div>
                        </div>
                    </div>

                    <div class="service-card">
                        <div class="service-title"><span>üé¨</span>Radarr</div>
                        <div class="form-field">
                            <label class="form-label">URL <span class="required">*</span></label>
                            <input class="form-input" type="url" id="radarr_url" name="radarr_url"
                                   value="http://radarr:7878" placeholder="http://radarr:7878" required>
                            <div class="form-help">URL compl√®te de l‚Äôinstance.</div>
                        </div>
                        <div class="form-field">
                            <label class="form-label">Cl√© API <span class="required">*</span></label>
                            <input class="form-input" type="text" id="radarr_api_key" name="radarr_api_key"
                                   placeholder="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" required>
                            <div class="form-help">Radarr ‚Üí Param√®tres ‚Üí S√©curit√©.</div>
                        </div>
                    </div>

                    <div class="service-card">
                        <div class="service-title"><span>üì∫</span>Sonarr</div>
                        <div class="form-field">
                            <label class="form-label">URL <span class="required">*</span></label>
                            <input class="form-input" type="url" id="sonarr_url" name="sonarr_url"
                                   value="http://sonarr:8989" placeholder="http://sonarr:8989" required>
                            <div class="form-help">URL compl√®te de l‚Äôinstance.</div>
                        </div>
                        <div class="form-field">
                            <label class="form-label">Cl√© API <span class="required">*</span></label>
                            <input class="form-input" type="text" id="sonarr_api_key" name="sonarr_api_key"
                                   placeholder="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" required>
                            <div class="form-help">Sonarr ‚Üí Param√®tres ‚Üí S√©curit√©.</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="page-section">
                <div class="section-header">Param√®tres</div>
                <div class="section-grid">
                    <div class="service-card">
                        <div class="form-field">
                            <label class="form-label">Intervalle de synchronisation</label>
                            <input class="form-input" type="number" id="sync_interval" name="sync_interval" value="3600">
                            <div class="form-help">Secondes entre chaque sync (3600 = 1h).</div>
                        </div>
                        <div class="form-field">
                            <label class="form-label">R√©tention torrents</label>
                            <input class="form-input" type="number" id="retention_hours" name="retention_hours" value="168">
                            <div class="form-help">Dur√©e de conservation (168 = 7 jours).</div>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="auto_purge" name="auto_purge" checked>
                            <label for="auto_purge" class="form-label" style="margin: 0;">Purge automatique des anciens torrents</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="page-section page-section--subtle">
                <div class="section-header">S√©curit√© (recommand√©e)</div>
                <div class="section-note">Ajoutez une authentification pour prot√©ger l‚Äôacc√®s √† l‚Äôinterface.</div>

                <div class="checkbox-group">
                    <input type="checkbox" id="auth_enabled" name="auth_enabled" data-action="toggle-auth">
                    <label for="auth_enabled" class="form-label" style="margin: 0; font-weight: 600; color: #1e90ff;">
                        ‚úÖ Activer l'authentification
                    </label>
                </div>
                <div id="auth_fields" style="display: none;">
                    <div class="form-field">
                        <label class="form-label">Nom d'utilisateur <span class="required">*</span></label>
                        <input class="form-input" type="text" id="auth_username" name="auth_username"
                               placeholder="admin" autocomplete="username">
                        <div class="form-help">Identifiant de connexion.</div>
                    </div>
                    <div class="form-field">
                        <label class="form-label">Mot de passe <span class="required">*</span></label>
                        <input class="form-input" type="password" id="auth_password" name="auth_password"
                               placeholder="Mot de passe s√©curis√©" autocomplete="new-password">
                        <div class="form-help">Minimum 8 caract√®res.</div>
                    </div>
                </div>
            </div>

            <div class="page-section">
                <div class="section-header">Actions finales</div>
                <div class="actions-bar">
                    <button type="submit" class="btn btn-primary" data-action="submit-setup">
                        ‚úÖ Enregistrer et d√©marrer
                    </button>
                    <button type="button" class="btn btn-secondary" data-action="test-connection">
                        üîå Tester la connexion
                    </button>
                </div>
            </div>
        </form>

        <div class="section-note" style="text-align: center;">
            Version {{ version }}
        </div>
    </div>

{% endblock %}

{% block scripts %}
<script src="/static/js/app.js"></script>
{% endblock %}
